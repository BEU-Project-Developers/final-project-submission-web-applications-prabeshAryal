@model PagedResponse<MusicApp.Models.DTOs.PlaylistDto>
@using MusicApp.Helpers
@{
    ViewData["Title"] = "Playlists";
    Random randomGen = new Random();
    string GetRandomImageUrl(int width, int height)
    {
        int randomId = randomGen.Next(1, 1085);
        return $"https://picsum.photos/id/{randomId}/{width}/{height}";
    }
    int currentPage = Model?.CurrentPage ?? 1;
    int totalPages = Model?.TotalPages ?? 1;
    int pageSize = Model?.PageSize ?? 20;
}

<div class="min-h-screen bg-[var(--ytm-bg-primary)] py-8">
    <div class="max-w-7xl mx-auto px-4">
        <div class="flex justify-between items-center mb-8 sticky top-0 z-10 bg-[var(--ytm-bg-primary)]">
            <h1 class="text-3xl font-bold text-[var(--ytm-text-primary)] mb-0">Your Playlists</h1>
            <a asp-action="Create" class="bg-[var(--ytm-accent-red)] hover:bg-[var(--ytm-accent-red-hover)] text-white px-4 py-2 rounded-lg transition-colors flex items-center">
                <i class="bi bi-plus-circle-fill mr-2"></i> Create Playlist
            </a>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            @foreach (var playlist in Model.Data)
            {
                <div class="bg-[var(--ytm-bg-secondary)] rounded-xl shadow border border-[var(--ytm-border-color)] flex flex-col h-full">
                    <a asp-action="Details" asp-route-id="@playlist.Id"></a>
                    <img src="@(string.IsNullOrEmpty(playlist.CoverImageUrl) ? GetRandomImageUrl(300, 300) : playlist.CoverImageUrl)" 
                         class="rounded-t-xl w-full object-cover" style="height:200px; background: var(--ytm-bg-tertiary);" alt="@playlist.Name"
                         onerror="this.src='https://placehold.co/300x300/212121/AAAAAA?text=Playlist';">
                    <div class="p-4 flex-1 flex flex-col">
                        <h5 class="font-semibold text-lg text-[var(--ytm-text-primary)] mb-1">@playlist.Name</h5>
                        <div class="text-[var(--ytm-text-secondary)] mb-2 text-sm">@playlist.Description</div>
                        <div class="flex flex-wrap gap-3 text-xs text-[var(--ytm-text-tertiary)] mt-auto">
                            <span><i class="bi bi-music-note-list"></i> @playlist.SongCount songs</span>
                            <span><i class="bi bi-person"></i> @playlist.Username</span>
                            <span><i class="bi bi-calendar"></i> @playlist.CreatedAt.ToString("MMM d, yyyy")</span>
                            <span class="px-2 py-0.5 rounded-full text-xs font-semibold ml-auto" style="background: @(playlist.IsPublic ? "var(--ytm-accent-green)" : "var(--ytm-bg-tertiary)"); color: @(playlist.IsPublic ? "#fff" : "var(--ytm-text-tertiary)");">
                                @(playlist.IsPublic ? "Public" : "Private")
                            </span>
                        </div>
                    </div>
                </div>
            }
        </div>
        <!-- Pagination Controls -->
        @if (totalPages > 1)
        {
            <nav class="flex justify-center mt-10">
                <ul class="inline-flex -space-x-px">
                    <li>
                        <a asp-action="Index" asp-route-page="@(currentPage - 1)" asp-route-pageSize="@pageSize" class="px-3 py-2 ml-0 leading-tight text-[var(--ytm-text-secondary)] bg-[var(--ytm-bg-tertiary)] border border-[var(--ytm-border-color)] rounded-l-lg @(currentPage == 1 ? "pointer-events-none opacity-50" : "hover:bg-[var(--ytm-bg-secondary)]")">Prev</a>
                    </li>
                    @for (int i = 1; i <= totalPages; i++)
                    {
                        <li>
                            <a asp-action="Index" asp-route-page="@i" asp-route-pageSize="@pageSize" class="px-3 py-2 leading-tight border border-[var(--ytm-border-color)] @(i == currentPage ? "bg-[var(--ytm-accent-red)] text-white" : "bg-[var(--ytm-bg-tertiary)] text-[var(--ytm-text-secondary)] hover:bg-[var(--ytm-bg-secondary)]")">@i</a>
                        </li>
                    }
                    <li>
                        <a asp-action="Index" asp-route-page="@(currentPage + 1)" asp-route-pageSize="@pageSize" class="px-3 py-2 leading-tight text-[var(--ytm-text-secondary)] bg-[var(--ytm-bg-tertiary)] border border-[var(--ytm-border-color)] rounded-r-lg @(currentPage == totalPages ? "pointer-events-none opacity-50" : "hover:bg-[var(--ytm-bg-secondary)]")">Next</a>
                    </li>
                </ul>
            </nav>
        }
        @if (!(Model.Data?.Any() ?? false))
        {
            <div class="mt-8 px-4 py-3 rounded-lg bg-[var(--ytm-bg-tertiary)] text-[var(--ytm-text-secondary)] border border-[var(--ytm-border-color)]">No playlists found. Create your first playlist!</div>
        }
    </div>
</div>

